{"version":3,"sources":["components/commons/test.js"],"names":["stime","Date","mssql","require","ldb","total","ipp","ttime","timeArr","sql","quizldb","open","async","iter","callback","param","key","value","type","queryWithConn","res","cnt","now","push","ops","i","length","obj","quizcode","batch","err","console","log","close"],"mappings":"AAAA;;;;AAIA;;AACA,IAAIA,QAAQ,IAAIC,IAAJ,EAAZ;AACA,IAAIC,QAAQC,QAAQ,SAAR,CAAZ;;AAEA,IAAIC,MAAMD,QAAQ,OAAR,CAAV;;AAEA,IAAIE,QAAQ,MAAZ,CAAmB;AAAnB;AAAA,IACMC,MAAM,IADZ;;AAGA,IAAIC,QAAQP,KAAZ;AACA,IAAIQ,UAAU,EAAd;;AAEA,IAAIC,MAAM,uBACN,iBADM,GAEN,YAFM,GAGN,UAHM,GAIN,sDAJM,GAKN,uEALM,GAMN,8EANM,GAON,oHAPM,GAQN,kEARM,GASN,sBATM,GAUN,YAVM,GAWN,mDAXJ;;AAaA,IAAIC,UAAUN,IAAIO,IAAJ,CAAS,SAAT,CAAd;;AAEA;;AAEA,SAASC,KAAT,CAAiBC,IAAjB,EAAwBC,QAAxB,EAAiC;AAC7B,QAAID,QAAQR,KAAZ,EAAoB;AAAES,mBAAY;AAAS;AAC3C,QAAIC,QAAQ,CACR,EAACC,KAAM,YAAP,EAAqBC,OAAQJ,OAAO,CAApC,EAAuCK,MAAO,KAA9C,EADQ,EAER,EAACF,KAAM,WAAP,EAAoBC,OAAQJ,OAAOP,GAAnC,EAAwCY,MAAO,KAA/C,EAFQ,CAAZ;AAIA;;;;;;;;;AASAhB,UAAMiB,aAAN,CAAoBV,GAApB,EAAyBM,KAAzB,EAAgC,UAASK,GAAT,EAAcC,GAAd,EAAkB;AAC9C,YAAIC,MAAM,IAAIrB,IAAJ,EAAV;AACAO,gBAAQe,IAAR,CAAcD,MAAMf,KAApB;AACA,YAAIiB,MAAM,EAAV;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,IAAIM,MAAxB,EAAgCD,GAAhC,EAAoC;AAChC,gBAAIE,MAAM,EAAET,MAAO,KAAT,EAAgBF,KAAMI,IAAIK,CAAJ,EAAOG,QAA7B,EAAuCX,OAAQG,IAAIK,CAAJ,CAA/C,EAAV;AACAD,gBAAID,IAAJ,CAASI,GAAT;AACH;AACDjB,gBAAQmB,KAAR,CAAcL,GAAd,EAAmB,UAASM,GAAT,EAAa;AAC5B,gBAAKA,GAAL,EAAW,MAAMA,GAAN;AACXC,oBAAQC,GAAR,CAAYX,GAAZ,EAAiBR,IAAjB,EAAwBS,MAAIf,KAA5B,EAAqC,IAAIN,IAAJ,KAAaqB,GAAlD;AACAf,oBAAQe,GAAR;AACAV,kBAAOC,OAAOP,GAAd,EAAmBQ,QAAnB;AACH,SALD;AAMH,KAdD;AAgBH;;AAEDF,MAAM,CAAN,EAAS,YAAU;AACf;AACAF,YAAQuB,KAAR;AACAF,YAAQC,GAAR,CAAYxB,OAAZ;AACAuB,YAAQC,GAAR,CAAa,IAAI/B,IAAJ,KAAaD,KAAd,GAAuB,IAAnC;AACH,CALD;;AAYA","file":"test.js","sourcesContent":["/**\r\n * 테스트 실행 코드\r\n * 비동기 색인 실행을 추적하기 위해 작성됨\r\n */\r\n\"use strict\";\r\nvar stime = new Date();\r\nvar mssql = require('./mssql');\r\n\r\nvar ldb = require('./ldb');\r\n\r\nvar total = 200000 //1273788\r\n    , ipp = 4000;\r\n\r\nvar ttime = stime;\r\nvar timeArr = [];\r\n\r\nvar sql = 'declare @rn int \\n' +\r\n    ' set @rn = 0 \\n' +\r\n    ' SELECT * ' +\r\n    ' FROM ( ' +\r\n    '     SELECT row_number() over(order by @rn) rownum, ' +\r\n    ' \t    quizcode, cmsid, inputuser, cdate, ctime, uuser, udate, utime, '+\r\n    '       title, quizpath, iostype, ioskind, jobstatus, pcode, groupno, hard2, '+\r\n    '       class1, class2, class3, class4, class5, class6, class7, class8, class9, class10, class11, class12, classa, '+\r\n    '       keyword, savetypef, supervisestatus, schcd, webox, cspcd ' +\r\n    ' FROM tbl_quiz_quiz ' +\r\n    ' ) paging ' +\r\n    ' where rownum between @firstIndex and @lastIndex ';\r\n\r\nvar quizldb = ldb.open('quizdoc');\r\n\r\n//quizldb.del();\r\n\r\nfunction async ( iter , callback){\r\n    if( iter >= total ) { callback(); return; }\r\n    var param = [\r\n        {key : 'firstIndex', value : iter + 1, type : 'Int' },\r\n        {key : 'lastIndex', value : iter + ipp, type : 'Int' }\r\n    ];\r\n    /*mssql.connect(function(){\r\n        mssql.query(sql, param, function(res, cnt){\r\n            var now = new Date();\r\n            timeArr.push((now - ttime));\r\n            console.log(cnt, i, (now-ttime));\r\n            ttime = now;\r\n            async( i + ipp, callback );\r\n        });\r\n    });*/\r\n    mssql.queryWithConn(sql, param, function(res, cnt){\r\n        var now = new Date();\r\n        timeArr.push((now - ttime));\r\n        var ops = [];\r\n        for (var i = 0; i < res.length; i++){\r\n            var obj = { type : 'put', key : res[i].quizcode, value : res[i] };\r\n            ops.push(obj);\r\n        }\r\n        quizldb.batch(ops, function(err){\r\n            if ( err ) throw err;\r\n            console.log(cnt, iter, (now-ttime), (new Date() - now));\r\n            ttime = now;\r\n            async( iter + ipp, callback );\r\n        });\r\n    });\r\n\r\n}\r\n\r\nasync(0, function(){\r\n    // mssql.close();\r\n    quizldb.close();\r\n    console.log(timeArr);\r\n    console.log((new Date() - stime) + 'ms')\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n//console.log(path.normalize(__dirname + '/../../dbs/name'));"]}